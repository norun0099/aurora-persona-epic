# =========================================================
# Aurora Persona Epic - Render Deploy (System Python Mode)
# =========================================================
# Renderのビルド／実行環境を分離する仕様に対応するため、
# .venvを使用せず、依存ライブラリをシステムPythonに直接導入する。
# これにより PyYAML 等が削除されず永続化される。
# =========================================================

services:
  - type: web
    name: aurora-persona-epic
    env: python
    region: oregon

    buildCommand: |
      echo "🔧 [Build] Installing dependencies into system Python..."
      pip install --upgrade pip
      pip install --no-cache-dir -r requirements.txt
      echo "📦 [Build] Forcing PyYAML reinstall (system-level)..."
      pip install --force-reinstall PyYAML

    startCommand: bash start.sh
    autoDeploy: true

    envVars:
      - key: PYTHONUNBUFFERED
        value: "1"
      - key: PORT
        value: "10000"
      - key: AURORA_PUSH_INTERVAL
        value: "600"
      - key: RENDER_ENV
        value: "true"
