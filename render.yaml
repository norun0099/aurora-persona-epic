services:
  - type: web
    name: aurora-persona-epic
    env: python
    buildCommand: |
      pip install -r requirements.txt

    startCommand: |
      # GitË®≠ÂÆö
      git config --global user.email "${GIT_USER_EMAIL}"
      git config --global user.name "${GIT_USER_NAME}"
      git remote add origin https://${GITHUB_TOKEN}@github.com/norun0099/aurora-persona-epic.git || echo "Remote already set"

      # ü©µ Aurora Heartbeat Ê∞∏Á∂öËµ∑ÂãïÔºàÁã¨Á´ã„Éó„É≠„Çª„ÇπÔºâ
      echo "Starting Aurora Heartbeat service..."
      bash -c "PYTHONPATH=. nohup python -u start_heartbeat.py > /tmp/heartbeat.log 2>&1 &"

      # „É°„Ç§„É≥API„Çµ„Éº„Éê„ÉºËµ∑Âãï
      echo "Starting Aurora API..."
      PYTHONPATH=aurora_memory uvicorn aurora_memory.api.main:app --host 0.0.0.0 --port $PORT

    envVars:
      - key: GIT_REPO_URL
        fromEnvVar: GIT_REPO_URL
      - key: GIT_USER_EMAIL
        fromEnvVar: GIT_USER_EMAIL
      - key: GIT_USER_NAME
        fromEnvVar: GIT_USER_NAME
      - key: GITHUB_TOKEN
        fromEnvVar: GITHUB_TOKEN
      - key: PORT
        value: 10000
      - key: AURORA_PUSH_INTERVAL
        fromEnvVar: AURORA_PUSH_INTERVAL
      - key: AURORA_MAX_QUEUE_SIZE
        fromEnvVar: AURORA_MAX_QUEUE_SIZE
      - key: AURORA_PUSH_RETRY_LIMIT
        fromEnvVar: AURORA_PUSH_RETRY_LIMIT
      - key: AURORA_PUSH_QUEUE_PATH
        fromEnvVar: AURORA_PUSH_QUEUE_PATH