# =========================================================
# Aurora Persona Epic - Render Deploy Configuration
# =========================================================
# Render上でのビルドと実行を安定化するための設定。
# .venv が削除されても PyYAML を含む依存関係を保持し、
# Aurora の FastAPI サーバーを安全に起動させる。
# =========================================================

services:
  - type: web
    name: aurora-persona-epic
    env: python
    region: oregon

    buildCommand: |
      echo "🔧 [Build] Installing Python dependencies..."
      pip install --upgrade pip
      pip install --no-cache-dir -r requirements.txt
      echo "📦 [Build] Installing PyYAML into persistent target..."
      pip install --target /opt/render/project/src/.venv/lib/python3.11/site-packages PyYAML

    startCommand: bash start.sh
    autoDeploy: true

    envVars:
      - key: PYTHONUNBUFFERED
        value: "1"
      - key: PORT
        value: "10000"
      - key: AURORA_PUSH_INTERVAL
        value: "600"
      - key: RENDER_ENV
        value: "true"
